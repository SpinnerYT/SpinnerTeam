import time
import threading
import keyboard
import pyautogui

class AutoClicker:
    def __init__(self, interval, activate_key, click_type):
        self.interval = interval
        self.activate_key = activate_key
        self.click_type = click_type
        self.running = False

    def start_clicking(self):
        print("Auto-clicker został uruchomiony. Klikam co", self.interval, "sekundy.")
        while self.running:
            if self.click_type == 'LMB':
                pyautogui.click()
                print("Kliknięcie lewym przyciskiem myszy (LMB)")
            elif self.click_type == 'RMB':
                pyautogui.click(button='right')
                print("Kliknięcie prawym przyciskiem myszy (RMB)")
            elif len(self.click_type) == 1:  # Zakładamy, że to klawisz na klawiaturze
                pyautogui.press(self.click_type)
                print(f"Naciskanie klawisza {self.click_type}")
            time.sleep(self.interval)
        print("Auto-clicker został zatrzymany.")

    def toggle_clicking(self):
        if self.running:
            self.running = False
        else:
            self.running = True
            threading.Thread(target=self.start_clicking).start()

def parse_command(command):
    try:
        parts = command.split('_')
        interval = float(parts[2].replace('sec', '').replace('(', '').replace(')', ''))
        activate_key = parts[4].replace('(', '').replace(')', '')
        click_type = parts[6].replace('(', '').replace(')', '')
        return interval, activate_key, click_type
    except Exception as e:
        print(f'Błąd w przetwarzaniu komendy: {e}')
        return None, None, None

def show_help():
    print("Thank you for downloading! :)")
    print("Official site : https://github.com/SpinnerYT/SpinnerTeam")
    print("AUTO CLICKER:")
    print("code_autoclicker_(co ile klikać np. 0.5)sec_activatekeycap_(jaki klawisz ma aktywować auto klikera)_Whatclick_(Jaki przycisk ma być klikany?)_endcode_start")
    print("LMB - Lewy przycisk myszy")
    print("RMB - Prawy przycisk myszy")

def main():
    while True:
        command = input("Wpisz Polecenie lub napisz pomoc: ")
        if command.lower() == 'pomoc':
            show_help()
        else:
            interval, activate_key, click_type = parse_command(command)
            if interval is not None and activate_key and click_type:
                auto_clicker = AutoClicker(interval, activate_key, click_type)
                print(f"Auto-clicker będzie aktywowany przez {activate_key} i będzie wykonywał akcję {click_type} co {interval} sekund.")
                
                while True:
                    keyboard.wait(activate_key)  # Czeka na naciśnięcie przycisku aktywacji
                    auto_clicker.toggle_clicking()  # Włącza lub wyłącza auto-clicker
            else:
                print("Niepoprawne polecenie. Wpisz 'pomoc' aby zobaczyć instrukcje.")

if __name__ == "__main__":
    main()